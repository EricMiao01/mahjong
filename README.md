# 🀄 終端機麻將

> 一款可以讓你在終端機通過純文字遊玩麻將的忙裡偷閒遊戲

用純 Python 在終端機裡打一局台灣麻將。支援 AI 陪打、方向鍵操作的全螢幕 TUI 介面；另附網路伺服器骨架，可作為未來聯機對戰的擴充基礎。

```
  麻將  牌庫剩 52 張

玩家 0 [AI]
亮：一 二 三
　　萬 萬 萬
棄：七 八
   萬 萬

玩家 1 ◀ 出牌中
亮：-

棄：-

──────────────────────────────────────────────────
上一手：玩家 0 打出 八萬
玩家 1，請選擇要打出的牌
玩家 1 的手牌
一 二 三 中 中 東 東 九
萬 萬 萬 中 中 東 東 萬

← → 移動    Enter 打出    ? 顯示/隱藏聽牌建議
```

---

## 遊戲規則

台灣麻將規則子集，支援：

- **牌種**：萬子（1–9）、筒子（1–9）、條子（1–9）、字牌（東南西北中發白）、花牌（梅蘭菊竹春夏秋冬）
- **基本動作**：摸牌、打牌、碰、吃（下家）、明槓、暗槓（自摸槓）
- **花牌補牌**：摸到花牌自動補牌，補到底
- **胡牌**：自摸或放炮皆可；支援「三面搭子 + 對眼」標準胡型

> 目前不計番數（台灣計番），純玩娛樂局。

---

## 功能特色

| 類別 | 說明 |
|------|------|
| 全螢幕 TUI | 以 Python 內建 `curses` 實作，無需額外安裝 UI 套件 |
| 方向鍵操作 | `← →` 移動選牌游標，`↑ ↓` 選擇動作，`Enter` 確認 |
| 直立牌面 | 每張牌分上下兩列顯示（數字在上、花色在下） |
| AI 陪打 | 1–3 位 AI 玩家自動決策（碰、吃、胡、打牌） |
| 暗槓偵測 | 發牌與摸牌時自動偵測可暗槓的牌並詢問 |
| 聽牌建議 | 按 `?` 切換，即時計算打哪張牌可以聽什麼 |
| 出牌記錄 | 畫面上常駐顯示上一手是誰打出什麼牌 |
| 胡牌結算 | 結算畫面標示勝者、放槍者、各家最終手牌 |
| 網路骨架 | `scripts/server.py` + `scripts/client.py`（Socket.IO，待擴充） |

---

## 操作鍵

| 按鍵 | 情境 | 說明 |
|------|------|------|
| `← →` | 選牌 | 移動手牌游標 |
| `↑ ↓` | 動作選單 | 選擇碰 / 吃 / 胡 / 略過 |
| `Enter` | 任意 | 確認當前選項 |
| `Esc` | 動作選單 | 略過（不碰/不吃） |
| `y` / `n` | 自摸詢問 | 確認或拒絕自摸胡牌 |
| `?` | 選牌中 | 切換聽牌建議顯示 |

---

## 快速開始

需要 **Python 3.10+**。

```bash
git clone <repo-url>
cd mahjong

# 使用 uv（推薦）
uv run main.py

# 或使用 pip
pip install -e .
python main.py
```

---

## 專案結構

```
mahjong/
├── main.py                 # 進入點，啟動 curses 並執行遊戲
├── pyproject.toml
└── src/mahjong/
    ├── tile.py             # Tile 類別：牌的代碼、花色、字串表示
    ├── deck.py             # Deck 類別：洗牌、從頭／從底摸牌
    ├── player.py           # Player 類別：手牌、亮牌、花牌、棄牌管理
    ├── rule_engine.py      # 規則引擎：碰/槓/吃/胡/暗槓/聽牌計算
    ├── ai.py               # SimpleAI：貪心策略的 AI 決策
    ├── game.py             # Game 類別：遊戲主流程、回合控制
    └── ui.py               # curses TUI：畫面繪製、鍵盤輸入處理

scripts/                    # 實驗性腳本
├── server.py               # Socket.IO 伺服器骨架（aiohttp）
└── client.py               # Socket.IO 客戶端骨架
```

---

## AI 策略說明

`SimpleAI` 採用貪心策略：

- **打牌**：計算每張牌的「保留分數」（對子 / 刻子 / 順子潛力），打出分數最低的牌
- **碰/槓**：模擬碰牌後順子潛力的損失比例；損失 ≤ 25% 才碰；字牌一律碰
- **反應優先順序**：胡 > 槓 > 碰 > 吃 > 略過

---

## 網路對戰（實驗性）

`scripts/` 中提供一個 Socket.IO 的連線骨架，目前僅實作：

- 玩家連線 / 斷線通知
- 打牌事件廣播（`play_tile`）

```bash
# 啟動伺服器
python scripts/server.py

# 在另一個終端機啟動客戶端
python scripts/client.py
```

> 完整聯機遊戲邏輯（同步手牌、發牌、規則裁決等）尚未實作，歡迎貢獻。

---

*以 Python 標準函式庫 `curses` 實作，跨 macOS / Linux 終端機執行。Windows 需搭配 `windows-curses`。*
